---
title: "Prey Delivery Analysis"
author: "Eliza Stein"
date: "11/5/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

##Libraries

```{r}
library(tidyverse)
```



##Load data

```{r}

pdOriginal <- read.csv("~/final-project/data/pd_main.csv")

#correct class for two time intervals
as.integer(pdOriginal$'166', pdOriginal$'211')

#rename the first column, which imported with a special character
names(pdOriginal)[1] <- "nest"
```



##Tidy data

First, get each time interval into its own row by gathering the data.
```{r}

pdGathered <- pdOriginal %>%
  gather(
    t0:t526, key = "time_interval",
    value = num_pd,
    na.rm = TRUE
  )

```

Some values in "num_pd" are blank or contain asterisks. Fix what we can and remove rows with NAs.
```{r}

#to remove asterisks
pdClean <- pdGathered %>%
  mutate(num_pd = gsub("\\*", "", num_pd))

#to make num_pd an integer, setting "" to NA
pdClean$num_pd <- as.integer(pdClean$num_pd)

#check number of blanks in pdClean vs pdGathered:
length(which(is.na(pdClean$num_pd))) #4752
length(which(pdGathered$num_pd=="")) #4750
#somehow there are 2 more NAs in pdClean after removing asterisks. If anything, pdClean is conservative count.


#pdGathered <- na_if(pdGathered$num_pd, "")
#pdGathered <- replace(pdGathered$num_pd, c("4*", "6*"), c(4, 6))

```


Select observations for males only:
```{r}

pdMales <- pdGathered %>%
  filter(
    sex == "M"
  )

```

Only want observations from Hayman (nest starts with "C") and Missouri (nest starts with "B"). 

First, separate "study_site" from "nest," removing the territory ID and the original column. Then, filter for only Hayman ("C") and Missouri ("B")
```{r}

pdHayMissou <- pdMales %>%
  separate(col = nest, into = c("study_site", NA), sep = 1, remove = TRUE) %>%
  filter(study_site == "B" | study_site == "C")

```

Quick plot to visualize data:
```{r}

plot(x = pdHayMissou$time_interval, y = pdHayMissou$num_pd)
  

```

